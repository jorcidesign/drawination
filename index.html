<!DOCTYPE html>
<html lang="en" class="notranslate" translate="no">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google" content="notranslate" />
    <title>Drawination</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" type="text/css" href="./assets/styles.css" />
    <!--[if lt IE 11]>
      <link
        rel="stylesheet"
        type="text/css"
        href="./input-range-polyfill/input-range-polyfill.css"
      />
    <![endif]-->
    <!-- <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/earlyaccess/nanumgothic.css"> -->
    <!-- CSS only -->

    <!-- <script src=".js/hand.minified-1.3.6.js"></script> -->
    <script src="./js/jquery-1.7.min.js"></script>
    <script
      src="https://kit.fontawesome.com/9fc64722e6.js"
      crossorigin="anonymous"
    ></script>
  </head>

  <body unselectable="on" oncontextmenu="return false;">
    <div class="toolbarDrawination">
      <header
        class="d-flex flex-wrap align-items-center justify-content-center justify-content-md-between py-3"
      >
        <div class="d-flex align-items-center col-md-3 mb-2 mb-md-0">
          <a
            class="text-decoration-none link-light px-2"
            href="#"
            id="clear-button"
            >Erase all</a
          >

          <ul class="nav">
            <li class="nav-item">
              <a id="flipCanvas" href="#" class="nav-link link-light px-2">
                <img
                  src="https://drawination.vercel.app/assets/flip.png"
                  alt="flip-icon"
                  style="width: 17px"
                  crossorigin="anonymous"
                />
              </a>
            </li>
          </ul>
        </div>

        <div class="nav col-12 col-md-auto mb-2 justify-content-center mb-md-0">
          <a class="navbar-brand">
            <input
              class="form-range"
              id="brush-size-slider"
              orient
              type="range"
              min="1"
              max="100"
            />
          </a>
          <a class="navbar-brand ms-2">
            <input
              class="form-range"
              id="brush-opacity-slider"
              orien
              type="range"
              min="0"
              max="100"
            />
          </a>
        </div>

        <div class="col-md-3 text-end">
          <a class="navbar-brand p-1" href="#" id="download"
            ><i class="fa-solid fa-download"></i
          ></a>
        </div>
      </header>
    </div>

    <nav class="py-2 toolbarDrawination">
      <div class="d-flex flex-wrap align-items-center container">
        <ul class="nav">
          <li class="nav-item">
            <a
              id="undoButton"
              href="#"
              class="nav-link link-light px-2"
              aria-current="page"
              ><i class="fa-solid fa-rotate-left"></i
            ></a>
          </li>
          <li class="nav-item">
            <a id="redoButton" href="#" class="nav-link link-light px-2"
              ><i class="fa-solid fa-rotate-right"></i
            ></a>
          </li>
          <li class="nav-item">
            <a id="zoomInButton" href="#" class="nav-link link-light px-2"
              ><i class="fa-solid fa-magnifying-glass-plus"></i
            ></a>
          </li>
          <li class="nav-item">
            <a id="zoomOutButton" href="#" class="nav-link link-light px-2"
              ><i class="fa-solid fa-magnifying-glass-minus"></i
            ></a>
          </li>
          <li class="nav-item">
            <a href="#" id="fitZoom" class="nav-link link-light px-2">Fit</a>
          </li>
        </ul>
        <ul class="nav justify-content-center mb-md-0 mx-auto">
          <li class="nav-item">
            <a class="navbar-brand" href="#">
              <i class="fa-solid fa-pencil p-2" id="sketch-brush"></i>

              <!-- <img hidden src="../assets/pencil.png" class="brush-image" crossorigin="anonymous" ></img> -->
            </a>
          </li>
          <li class="nav-item">
            <a class="navbar-brand" href="#">
              <i class="fa-solid fa-pen-fancy p-2" id="lineart-brush"></i>
              <!-- <img src="https://drawination.vercel.app/assets/brushHard.png" id="lineart-brush" class="brush-image" alt="brush hard" crossorigin="anonymous" loading="eager"></img> -->
              <!-- <img hidden src="../assets/brushHard.png" class="brush-image" crossorigin="anonymous"></img> -->
            </a>
          </li>
          <li class="nav-item">
            <a class="navbar-brand" href="#">
              <i class="fa-solid fa-paintbrush p-2" id="shadow-brush"></i>
              <!-- <img hidden src="../assets/shadowBrush3.png" class="brush-image" crossorigin="anonymous"></img> -->
            </a>
          </li>
          <li class="nav-item px-2">
            <a class="navbar-brand" href="#">
              <div class="form-check form-switch">
                <input
                  class="form-check-input"
                  id="select-eraser-checkbox"
                  type="checkbox"
                />
                <i class="fa-solid fa-eraser"></i>
              </div>
            </a>
          </li>
        </ul>
        <ul class="nav justify-content-end">
          <li class="nav-item">
            <a class="navbar-brand" href="#">
              <div
                class="colorSelected colorSelected-black colorSelected_active"
              ></div>

              <!-- <img hidden src="../assets/pencil.png" class="brush-image" crossorigin="anonymous" ></img> -->
            </a>
          </li>
          <li class="nav-item">
            <a class="navbar-brand" href="#">
              <div class="colorSelected colorSelected-white"></div>

              <!-- <img hidden src="../assets/pencil.png" class="brush-image" crossorigin="anonymous" ></img> -->
            </a>
          </li>
          <li class="nav-item">
            <a class="navbar-brand" href="#">
              <div class="colorSelected colorSelected-red"></div>

              <!-- <img hidden src="../assets/pencil.png" class="brush-image" crossorigin="anonymous" ></img> -->
            </a>
          </li>
          <li class="nav-item">
            <a class="navbar-brand" href="#">
              <div class="colorSelected colorSelected-blue"></div>

              <!-- <img hidden src="../assets/pencil.png" class="brush-image" crossorigin="anonymous" ></img> -->
            </a>
          </li>
          <li class="nav-item">
            <a class="navbar-brand" href="#">
              <div class="colorSelected colorSelected-green"></div>

              <!-- <img hidden src="../assets/pencil.png" class="brush-image" crossorigin="anonymous" ></img> -->
            </a>
          </li>
        </ul>
      </div>
    </nav>

    <!-- <div class="colorContainer" id="colorContainerDiv"></div> -->

    <!-- <img  id="imageBackground" src="./assets/PaperSurface_15.png" > -->
    <canvas hidden id="canvasExport" width="720" height="720"></canvas>

    <div id="container">
      <div class="area">
        <div id="divContainer" class="ar-1-1">
          <!-- <canvas id="myCanvas"></canvas>s -->
          <div class="" id="canvas-area"></div>
        </div>
      </div>
    </div>

    <!-- <div id="draggable" class="no-select">drag me</div> -->

    <style>
      body {
        overflow: hidden;
      }

      #container {
        position: fixed;
        left: 50%;
        top: 55%;
        transform: translate(-50%, -50%);
        width: 720px;
        height: 720px;
        z-index: -1000;
      }

      .area {
        /* border: 1px dashed black; */
        height: 100%;
        width: 100%;
        position: absolute;
      }
    </style>

    <!--[if lt IE 11]>
      <script src="./input-range-polyfill/input-range-polyfill.js"></script>
    <![endif]-->
    <!-- <script src="./js/tinycolor.js"></script>
  <script src="./js/HSBRect.js"></script> -->
    <script src="./js/croquis.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.1.1/gsap.min.js"></script>

    <script src="./js/croquispop.js"></script>

    <!-- mejorar este script para la conveniencia del negocio -->
    <!--[if lt IE 10]>
      <script></script>
    <![endif]-->
    <script>
      // import {croquispop} from croquispop.js;
      const hasPositionChanged = ({ pos, prevPos }) => pos !== prevPos;

      const valueInRange = ({ minScale, maxScale, scale }) =>
        scale <= maxScale && scale >= minScale;

      const getTranslate =
        ({ minScale, maxScale, scale }) =>
        ({ pos, prevPos, translate }) =>
          valueInRange({ minScale, maxScale, scale }) &&
          hasPositionChanged({ pos, prevPos })
            ? translate + (pos - prevPos * scale) * (1 - 1 / scale)
            : translate;

      const getMatrix = ({ scale, translateX, translateY }) =>
        `matrix(${scale}, 0, 0, ${scale}, ${translateX}, ${translateY})`;

      const getScale = ({
        scale,
        minScale,
        maxScale,
        scaleSensitivity,
        deltaScale,
      }) => {
        let newScale = scale + deltaScale / (scaleSensitivity / scale);
        newScale = Math.max(minScale, Math.min(newScale, maxScale));
        return [scale, newScale];
      };

      const pan = ({ state, originX, originY }) => {
        state.transformation.translateX += originX;
        state.transformation.translateY += originY;
        state.element.style.transform = getMatrix({
          scale: state.transformation.scale,
          translateX: state.transformation.translateX,
          translateY: state.transformation.translateY,
        });
      };

      const canPan = (state) => ({
        panBy: ({ originX, originY }) => pan({ state, originX, originY }),
        panTo: ({ originX, originY, scale }) => {
          state.transformation.scale = scale;
          pan({
            state,
            originX: originX - state.transformation.translateX,
            originY: originY - state.transformation.translateY,
          });
        },
      });

      const canZoom = (state) => ({
        zoom: ({ x, y, deltaScale }) => {
          const { left, top } = state.element.getBoundingClientRect();
          const { minScale, maxScale, scaleSensitivity } = state;
          const [scale, newScale] = getScale({
            scale: state.transformation.scale,
            deltaScale,
            minScale,
            maxScale,
            scaleSensitivity,
          });
          const originX = x - left;
          const originY = y - top;
          const newOriginX = originX / scale;
          const newOriginY = originY / scale;
          const translate = getTranslate({ scale, minScale, maxScale });
          const translateX = translate({
            pos: originX,
            prevPos: state.transformation.originX,
            translate: state.transformation.translateX,
          });
          const translateY = translate({
            pos: originY,
            prevPos: state.transformation.originY,
            translate: state.transformation.translateY,
          });

          state.element.style.transformOrigin = `${newOriginX}px ${newOriginY}px`;
          state.element.style.transform = getMatrix({
            scale: newScale,
            translateX,
            translateY,
          });
          state.transformation = {
            originX: newOriginX,
            originY: newOriginY,
            translateX,
            translateY,
            scale: newScale,
          };
          // console.log(newScale);
          brush.setScaleFactor(newScale);
          brush2.setScaleFactor(newScale);
          brush3.setScaleFactor(newScale);
        },
      });

      const renderer = ({
        minScale,
        maxScale,
        element,
        scaleSensitivity = 10,
      }) => {
        const state = {
          element,
          minScale,
          maxScale,
          scaleSensitivity,
          transformation: {
            originX: 0,
            originY: 0,
            translateX: 0,
            translateY: 0,
            scale: 1,
          },
        };
        return Object.assign({}, canZoom(state), canPan(state));
      };

      const container = document.getElementById("container");
      const instance = renderer({
        scaleSensitivity: 10,
        minScale: 0.1,
        maxScale: 30,
        element: container.children[0],
      });
      container.addEventListener("wheel", (event) => {
        if (!event.ctrlKey) {
          return;
        }
        event.preventDefault();
        instance.zoom({
          deltaScale: Math.sign(event.deltaY) > 0 ? -1 : 1,
          x: event.pageX,
          y: event.pageY,
        });
      });
      let zoomIn = document.getElementById("zoomInButton");

      zoomIn.addEventListener("pointerdown", () => {
        event.preventDefault();
        instance.zoom({
          deltaScale: 1,
          x: event.pageX,
          y: event.pageY,
        });
      });

      let zoomOut = document.getElementById("zoomOutButton");

      zoomOut.addEventListener("pointerdown", () => {
        event.preventDefault();
        instance.zoom({
          deltaScale: -1,
          x: event.pageX,
          y: event.pageY,
        });
      });
      let fitZoom = document.getElementById("fitZoom");
      fitZoom.addEventListener("pointerdown", () => {
        instance.panTo({
          originX: 0,
          originY: 0,
          scale: 1,
        });
        brush.setScaleFactor(1);
        brush2.setScaleFactor(1);
        brush3.setScaleFactor(1);
      });

      let shouldHandleKeyDown = true;
      document.addEventListener("keydown", function (event) {
        if (event.ctrlKey) {
          if (!shouldHandleKeyDown) return;
          croquisDOMElement.removeEventListener(
            "pointerdown",
            canvasPointerDown
          );

          // Handle "down"

          shouldHandleKeyDown = false;
        }
      });

      document.addEventListener("keyup", (event) => {
        // As the user releases the Ctrl key, the key is no longer active,
        // so event.ctrlKey is false.
        croquisDOMElement.addEventListener("pointerdown", canvasPointerDown);
        shouldHandleKeyDown = true;
      });

      function containerPointerDown(event) {
        // setPointerEvent(event);
        if (!event.ctrlKey) {
          return;
        }
        container.addEventListener("pointermove", containerPointerMove);
        container.addEventListener("pointerup", containerPointerUp);
      }
      // e.pointerType === "pen" ? e.pressure : 1
      //al mover el puntero
      function containerPointerMove(event) {
        // setPointerEvent(event);
        if (!event.ctrlKey) {
          return;
        }
        event.preventDefault();
        instance.panBy({
          originX: event.movementX,
          originY: event.movementY,
        });
      }

      //encima del canvas
      function containerPointerUp(e) {
        // setPointerEvent(e);

        container.removeEventListener("pointermove", containerPointerMove);
        container.removeEventListener("pointerup", containerPointerUp);
      }

      container.addEventListener("pointerdown", containerPointerDown);

      // container.addEventListener("pointermove", (event) => {

      // })
    </script>
  </body>
</html>
